<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Canteen Experience</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link rel="stylesheet" href="css/theme.css">
    <style>
        /* Inline helpers only for the new login & status controls.
           Main styling should still come from css/theme.css */
        .login-overlay {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #f5f7fb, #e4ecff);
        }
        .login-card {
            max-width: 480px;
            width: 100%;
            background: #fff;
            border-radius: 18px;
            box-shadow: 0 20px 40px rgba(15, 23, 42, 0.18);
            padding: 32px 28px;
        }
        .login-role-btn {
            border-radius: 999px;
        }
        .status-stage-pill {
            font-size: 0.8rem;
            padding: 4px 10px;
            border-radius: 999px;
        }
        .status-stage-pill.active {
            background: #0d6efd;
            color: #fff;
        }
        .status-stage-pill.inactive {
            background: #e9ecef;
            color: #495057;
        }
        .status-meta {
            font-size: 0.85rem;
        }
        .order-control-panel {
            background: #f8f9fa;
            border-radius: 16px;
            padding: 1.5rem;
        }
        .order-info-card {
            background: #fff;
            border: 1px solid var(--erp-border);
            border-radius: 14px;
            padding: 1.25rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.04);
        }
        .order-status-badge .badge {
            font-size: 0.9rem;
            font-weight: 600;
        }
        .order-action-buttons .order-status-btn {
            border-radius: 10px;
            font-weight: 600;
            transition: all 0.2s ease;
        }
        .order-action-buttons .order-status-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        .notification-item {
            border: 1px solid var(--erp-border);
            border-radius: 14px;
            padding: 1rem;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            background: #fff;
            transition: all 0.2s ease;
        }
        .notification-item:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            transform: translateY(-2px);
        }
        .notification-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        .order-update.accepted .notification-icon {
            background: rgba(45, 156, 91, 0.1);
        }
        .order-update.ready .notification-icon {
            background: rgba(123, 22, 49, 0.1);
        }
        .wallet-update.low-balance .notification-icon {
            background: rgba(255, 193, 7, 0.1);
        }
        .wallet-update .notification-icon {
            background: rgba(45, 156, 91, 0.1);
        }
        .notification-content h6 {
            color: var(--erp-maroon-dark);
            font-size: 0.95rem;
        }
    </style>
</head>
<body onload="initApp()">

    <!-- LOGIN PAGE -->
    <section id="loginSection" class="login-overlay">
        <div class="login-card">
            <h2 class="mb-1">Smart Canteen Login</h2>
            <p class="text-muted mb-4">Sign in as student, staff, or admin to continue.</p>

            <div class="mb-3">
                <label class="form-label fw-semibold">Select Role</label>
                <div class="btn-group w-100" role="group" aria-label="Role selection">
                    <input type="radio" class="btn-check" name="role" id="roleStudent" value="student" checked>
                    <label class="btn btn-outline-primary login-role-btn" for="roleStudent">Student</label>

                    <input type="radio" class="btn-check" name="role" id="roleStaff" value="staff">
                    <label class="btn btn-outline-primary login-role-btn" for="roleStaff">Staff</label>

                    <input type="radio" class="btn-check" name="role" id="roleAdmin" value="admin">
                    <label class="btn btn-outline-primary login-role-btn" for="roleAdmin">Admin</label>
                </div>
            </div>

            <div class="mb-3">
                <label for="loginId" class="form-label">Register / Staff / Admin ID</label>
                <input type="text" class="form-control" id="loginId" placeholder="e.g., 22IT1234">
            </div>

            <div class="mb-3">
                <label for="loginPassword" class="form-label">Password</label>
                <input type="password" class="form-control" id="loginPassword" placeholder="Enter password">
            </div>

            <button id="loginButton" class="btn btn-primary w-100 mb-3">Login</button>
            <button id="showRegisterBtn" class="btn btn-outline-primary w-100 mb-2">New User Register</button>
            <p class="text-muted small mb-0">This is a demo login – any ID & password combination will work.</p>
        </div>

        <!-- REGISTRATION CARD -->
        <div class="login-card d-none" id="registerCard">
            <h2 class="mb-1">New User Registration</h2>
            <p class="text-muted mb-4">Create your account to get started.</p>

            <div class="mb-3">
                <label class="form-label fw-semibold">Select Role</label>
                <div class="btn-group w-100" role="group" aria-label="Role selection">
                    <input type="radio" class="btn-check" name="registerRole" id="registerRoleStudent" value="student" checked>
                    <label class="btn btn-outline-primary login-role-btn" for="registerRoleStudent">Student</label>

                    <input type="radio" class="btn-check" name="registerRole" id="registerRoleStaff" value="staff">
                    <label class="btn btn-outline-primary login-role-btn" for="registerRoleStaff">Staff</label>

                    <input type="radio" class="btn-check" name="registerRole" id="registerRoleAdmin" value="admin">
                    <label class="btn btn-outline-primary login-role-btn" for="registerRoleAdmin">Admin</label>
                </div>
            </div>

            <div class="mb-3">
                <label for="registerFullName" class="form-label">Full Name</label>
                <input type="text" class="form-control" id="registerFullName" placeholder="Enter your full name">
            </div>

            <div class="mb-3">
                <label for="registerId" class="form-label">Register / Staff / Admin ID</label>
                <input type="text" class="form-control" id="registerId" placeholder="e.g., 22IT1234">
            </div>

            <div class="mb-3">
                <label for="registerPassword" class="form-label">Password</label>
                <input type="password" class="form-control" id="registerPassword" placeholder="Enter password">
                <small class="text-muted d-block mt-1">
                    <strong>Password Rules:</strong><br>
                    • 8-12 characters<br>
                    • 1 uppercase letter (A-Z)<br>
                    • 1 lowercase letter (a-z)<br>
                    • 1 number (0-9)<br>
                    • 1 special character (@, #, $, %, &, !, etc.)<br>
                    • No spaces allowed
                </small>
                <div id="passwordError" class="text-danger small mt-1 d-none"></div>
            </div>

            <div class="mb-3">
                <label for="registerConfirmPassword" class="form-label">Confirm Password</label>
                <input type="password" class="form-control" id="registerConfirmPassword" placeholder="Confirm password">
            </div>

            <button id="registerButton" class="btn btn-primary w-100 mb-3">Register</button>
            <button id="backToLoginBtn" class="btn btn-outline-secondary w-100">Back to Login</button>
        </div>
    </section>

    <!-- MAIN APP -->
    <header class="erp-topbar d-none" id="mainHeader">
        <div class="container d-flex flex-column flex-md-row justify-content-between align-items-md-center">
            <div class="nav-links d-flex flex-wrap align-items-center">
                <a href="#" class="fw-semibold" id="homeLink">Smart Canteen Portal</a>
                <a href="slots.html">Slots</a>
                <a href="menu.html">Menu</a>
                <a href="orders.html">Orders</a>
            </div>
            <div class="nav-actions mt-3 mt-md-0">
                <div class="notification-bell">
                    <i class="fas fa-bell"></i>
                    <span class="notif-dot"></span>
                </div>
                <a href="cart.html" class="cart-icon" style="text-decoration: none; color: inherit;">
                    <i class="fas fa-shopping-cart"></i>
                    <span class="cart-count" id="cartCount">3</span>
                </a>
                <div class="dropdown">
                    <button class="profile-pill dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" id="profileDropdown">
                        <div class="avatar" id="profileInitials">SC</div>
                        <div class="profile-meta">
                            <span class="label" id="profileName">Smart Canteen User</span>
                            <small id="profileMeta">Role: -</small>
                        </div>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li><a class="dropdown-item" href="order-history.html">My Orders</a></li>
                        <li><a class="dropdown-item" href="book-slot.html">My Slots</a></li>
                        <li><a class="dropdown-item" href="index.html#orders">My Wallet</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><button class="dropdown-item text-danger" id="logoutButton">Logout</button></li>
                    </ul>
                </div>
            </div>
        </div>
    </header>

    <main class="erp-page-wrapper d-none" id="mainApp">
        <div class="container">
            <section class="erp-shell hero-panel mb-4">
                <div class="row g-4 align-items-center">
                    <div class="col-lg-6">
                        <p class="erp-profile-badge d-inline-flex align-items-center gap-2 mb-3">
                            <i class="fas fa-circle text-success small"></i> Live campus operations
                        </p>
                        <h1 class="hero-title">Reserve slots, track food prep, and collect via QR.</h1>
                        <p class="erp-muted mb-4">A next-gen canteen control center with ERP polish, wallet payments, push alerts, and realtime slot intelligence.</p>
                        <div class="d-flex flex-wrap gap-3">
                            <button id="bookSlotBtn" class="btn btn-primary px-4"><i class="fas fa-ticket-alt me-2"></i>Book a Slot</button>
                            <button id="showQrBtn" class="btn btn-outline-light text-dark px-4 border-0 bg-body-tertiary"><i class="fas fa-qrcode me-2"></i>Show QR</button>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="highlight-grid">
                            <div>
                                <span class="highlight-label">Live Orders</span>
                                <h3 id="liveOrders">42</h3>
                                <small class="text-success">+18% vs yesterday</small>
                            </div>
                            <div>
                                <span class="highlight-label">Wallet Balance</span>
                                <h3>₹<span id="walletBalance">85</span></h3>
                                <small class="text-muted">Auto top-up enabled</small>
                            </div>
                            <div>
                                <span class="highlight-label">Avg Prep Time</span>
                                <h3 id="prepTime">08m</h3>
                                <small class="text-warning">Kitchen busy</small>
                            </div>
                            <div>
                                <span class="highlight-label">Favourite Items</span>
                                <h3 id="favCount">9</h3>
                                <small class="text-muted">Wishlist curated</small>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="slots" class="mb-4">
                <div class="section-heading d-flex justify-content-between align-items-center">
                    <div>
                        <h4 class="erp-page-title mb-1">Realtime Slot Availability</h4>
                        <p class="erp-muted mb-0">Stay ahead of the rush with live capacity counters.</p>
                    </div>
                    <button id="syncSlotsBtn" class="btn btn-success px-4"><i class="fas fa-sync me-2"></i>Sync Availability</button>
                </div>
                <div class="slot-grid mt-3" id="slotGrid"></div>
            </section>

            <section id="menu" class="erp-shell mb-4">
                <div class="section-heading d-flex flex-column flex-md-row justify-content-between gap-3 align-items-md-center">
                    <div>
                        <h4 class="erp-page-title mb-1">Discover Menu</h4>
                        <p class="erp-muted mb-0">Search, filter, and favourite your staples.</p>
                    </div>
                    <div class="search-bar">
                        <i class="fas fa-search"></i>
                        <input type="text" placeholder="Search Dosa, Veg Rice, Chappathi..." id="menuSearch">
                    </div>
                </div>
                <div class="filter-group mt-3">
                    <button class="erp-filter-btn active">All</button>
                    <button class="erp-filter-btn">Veg</button>
                    <button class="erp-filter-btn">Non-Veg</button>
                    <button class="erp-filter-btn">Price ↑</button>
                    <button class="erp-filter-btn">Rating</button>
                    <button class="erp-filter-btn">Popular</button>
                </div>
                <div class="row g-3 mt-1" id="menuGrid"></div>
            </section>

            <section id="orders" class="row g-4 mb-4">
                <div class="col-lg-6">
                    <div class="erp-shell status-tracker h-100">
                        <div class="section-heading mb-3">
                            <h4 class="erp-page-title mb-1">Food Preparation Status</h4>
                            <p class="erp-muted mb-2" id="currentOrderLabel">Live journey of Order #SCB1024.</p>
                            <div class="d-flex flex-wrap align-items-center gap-2 mb-2">
                                <span class="text-muted small me-2">Current stage:</span>
                                <button type="button" class="btn btn-sm btn-outline-primary status-stage-pill" data-stage="cooking">Cooking</button>
                                <button type="button" class="btn btn-sm btn-outline-primary status-stage-pill" data-stage="packing">Packing</button>
                                <button type="button" class="btn btn-sm btn-outline-primary status-stage-pill" data-stage="ready">Ready</button>
                            </div>
                            <p class="status-meta mb-0"><strong>Estimated time:</strong> <span id="statusEta">--</span> • <strong>Items:</strong> <span id="statusItems">--</span></p>
                        </div>
                        <ul class="status-steps" id="statusSteps"></ul>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="erp-shell qr-wallet h-100">
                        <div class="d-flex flex-column flex-md-row gap-4">
                            <div class="flex-fill">
                                <h5 class="fw-semibold mb-3">QR Pickup Pass</h5>
                                <div class="erp-qr mb-3">
                                    <i class="fas fa-qrcode fa-3x"></i>
                                </div>
                                <p class="mb-1 fw-semibold">Order #SCB1024</p>
                                <p class="erp-muted">Scan at kiosk to mark as collected.</p>
                            </div>
                            <div class="flex-fill">
                                <div class="wallet-card mb-3">
                                    <p class="mb-1 text-uppercase small">Campus Wallet</p>
                                    <h3>₹<span id="walletCardBalance">85.00</span></h3>
                                    <p class="erp-muted mb-2">Last top-up: ₹200 via UPI</p>
                                    <button id="addMoneyBtn" class="btn btn-primary btn-sm px-3">Add Money</button>
                                </div>
                                <div class="wishlist-card">
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <h6 class="mb-0">Wishlist</h6>
                                        <button id="manageWishlistBtn" class="btn btn-link p-0 text-decoration-none small">Manage</button>
                                    </div>
                                    <div class="wishlist-chips" id="wishlistChips"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section class="row g-4 mb-4">
                <div class="col-12">
                    <div class="erp-shell admin-board h-100">
                        <div class="section-heading mb-4">
                            <h4 class="erp-page-title mb-1">Order Status Control</h4>
                            <p class="erp-muted mb-0">Manage order preparation stages</p>
                        </div>
                        <div class="order-control-panel mb-4">
                            <div class="order-info-card mb-3">
                                <div class="d-flex align-items-center justify-content-between flex-wrap gap-3">
                                    <div class="flex-grow-1">
                                        <h5 class="mb-1 fw-semibold" style="color: var(--erp-maroon-dark);" id="orderItemsDisplay">Order #SCB1024 — Dosa ×1, Tea ×1</h5>
                                        <p class="mb-0 erp-muted small">Click status buttons below to update order progress</p>
                                    </div>
                                    <div class="order-status-badge">
                                        <span class="badge bg-warning text-dark px-3 py-2" id="currentOrderStatus">Preparing</span>
                                    </div>
                                </div>
                            </div>
                            <div class="order-action-buttons d-flex flex-wrap gap-2">
                                <button id="acceptOrderBtn" class="btn btn-success px-4 order-status-btn">
                                    <i class="fas fa-check-circle me-2"></i>Accept
                                </button>
                                <button id="prepareOrderBtn" class="btn btn-warning px-4 order-status-btn">
                                    <i class="fas fa-utensils me-2"></i>Prepare
                                </button>
                                <button id="readyOrderBtn" class="btn btn-primary px-4 order-status-btn">
                                    <i class="fas fa-check-double me-2"></i>Ready
                                </button>
                                <button id="collectedOrderBtn" class="btn btn-primary px-4 order-status-btn">
                                    <i class="fas fa-hand-holding me-2"></i>Collected
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section class="row g-4">
                <div class="col-lg-6">
                    <div class="erp-shell notifications h-100">
                        <div class="section-heading mb-3">
                            <h4 class="erp-page-title mb-1">Order Updates</h4>
                            <p class="erp-muted mb-0">Real-time order status notifications</p>
                        </div>
                        <div id="notificationStream">
                            <div class="notification-item order-update accepted">
                                <div class="notification-icon">
                                    <i class="fas fa-check-circle text-success"></i>
                                </div>
                                <div class="notification-content flex-grow-1">
                                    <h6 class="mb-1 fw-semibold">Your order is Accepted</h6>
                                    <p class="mb-0 erp-muted small">Order #SCB1024 has been accepted and is being prepared</p>
                                </div>
                            </div>
                            <div class="notification-item order-update ready">
                                <div class="notification-icon">
                                    <i class="fas fa-check-circle text-success"></i>
                                </div>
                                <div class="notification-content flex-grow-1">
                                    <h6 class="mb-1 fw-semibold">Your order is Ready for Pickup</h6>
                                    <p class="mb-0 erp-muted small">Order #SCB1024 is ready. Please collect from Counter 3</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="erp-shell notifications h-100">
                        <div class="section-heading mb-3">
                            <h4 class="erp-page-title mb-1">Wallet Update</h4>
                            <p class="erp-muted mb-0">Account balance alerts</p>
                        </div>
                        <div id="walletNotifications">
                            <div class="notification-item wallet-update low-balance">
                                <div class="notification-icon">
                                    <i class="fas fa-exclamation-triangle text-warning"></i>
                                </div>
                                <div class="notification-content flex-grow-1">
                                    <h6 class="mb-1 fw-semibold">Low balance: Add money</h6>
                                    <p class="mb-0 erp-muted small">Your wallet balance is below ₹100. Top up to continue ordering</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section class="row g-4 mt-2">
                <div class="col-12">
                    <div class="erp-shell support-card h-100">
                        <h4 class="erp-page-title mb-2">Need Help?</h4>
                        <p class="erp-muted">Campus concierge available 9am-9pm.</p>
                        <ul class="list-unstyled mt-3 mb-4">
                            <li><i class="fas fa-envelope me-2 text-primary"></i>canteensupport@sathyabama.ac.in</li>
                            <li><i class="fas fa-phone me-2 text-primary"></i>+91 98765 43210</li>
                            <li><i class="fas fa-location-dot me-2 text-primary"></i>Block 3 • Student Services Wing</li>
                        </ul>
                        <button id="supportBtn" class="btn btn-primary px-4">Open Support Ticket</button>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/script.js"></script>
</body>
</html>
